<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jump Runner ‚Äî –ø—Ä–æ–±–µ–ª + –∑–∞—Ä—è–¥–∫–∞ –ø—Ä—ã–∂–∫–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
            touch-action: pan-y;
        }
        .game-container {
            background: #2c3e50;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            max-width: 450px;
            width: 100%;
        }
        canvas {
            display: block;
            width: 100%;
            height: auto;
            border-radius: 10px;
            cursor: pointer;
            touch-action: none;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            color: white;
        }
        .scores {
            display: flex;
            gap: 30px;
            font-size: 18px;
            font-weight: bold;
        }
        .restart-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            touch-action: manipulation;
            box-shadow: 0 4px 0 #c0392b;
        }
        .restart-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }
        .instructions {
            color: #bdc3c7;
            margin-top: 10px;
            font-size: 14px;
            text-align: center;
        }
        @media (max-width: 600px) {
            .game-container { padding: 10px; }
            .scores { font-size: 16px; gap: 20px; }
            .restart-btn { padding: 8px 20px; font-size: 14px; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="gameCanvas" width="400" height="600"></canvas>
        <div class="controls">
            <div class="scores">
                <div>üí∞ <span id="coinCount">0</span></div>
                <div>üèÜ <span id="scoreCount">0</span></div>
            </div>
            <button class="restart-btn" id="restartBtn">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>
        <div class="instructions">
            üëÜ –ó–∞–∂–º–∏ —ç–∫—Ä–∞–Ω / –ü–†–û–ë–ï–õ ‚Äî —á–µ–º –¥–æ–ª—å—à–µ –¥–µ—Ä–∂–∏—à—å, —Ç–µ–º –≤—ã—à–µ –ø—Ä—ã–∂–æ–∫! | –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –Ω–∞ —Ä–∞–∑–Ω–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const coinSpan = document.getElementById('coinCount');
        const scoreSpan = document.getElementById('scoreCount');
        const restartBtn = document.getElementById('restartBtn');

        // ---------- –ù–ê–°–¢–†–û–ô–ö–ò ----------
        const GROUND_Y = 500;
        const PLAYER_SIZE = 40;
        const OBSTACLE_SIZE = 30;
        const COIN_SIZE = 20;

        // ---------- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–û–ö–ê ----------
        let player = {
            x: 50, y: GROUND_Y - PLAYER_SIZE,
            width: PLAYER_SIZE, height: PLAYER_SIZE,
            velY: 0, gravity: 0.5,
            minJumpPower: -9,     // –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∏–ª–∞ (–∫–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∂–∞—Ç–∏–µ)
            maxJumpPower: -17,    // –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∏–ª–∞ (–¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ)
            maxHoldTime: 600,     // –º—Å ‚Äî –ø–æ–ª–Ω–æ–µ –∑–∞—Ä—è–∂–∞–Ω–∏–µ
            isJumping: false,
            color: '#3498db'
        };

        // ---------- –ò–ì–†–û–í–´–ï –û–ë–™–ï–ö–¢–´ ----------
        let obstacles = [];
        let coins = [];
        let gameSpeed = 5;
        let score = 0;
        let coinsCollected = 0;
        let gameOver = false;
        let gameStarted = false;
        let animationId = null;

        // ---------- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –°–õ–£–ß–ê–ô–ù–û–ì–û –°–ü–ê–í–ù–ê ----------
        let nextObstacleCounter = 0;
        let nextCoinCounter = 0;

        // ---------- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –ó–ê–†–Ø–î–ö–ò –ü–†–´–ñ–ö–ê ----------
        let jumpPressed = false;
        let jumpStartTime = 0;
        let jumpPower = 0;

        // ---------- –î–õ–Ø –ö–õ–ê–í–ò–ê–¢–£–†–´ (–ü–†–û–ë–ï–õ) ----------
        let spacePressed = false;
        let spaceStartTime = 0;

        // ---------- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ----------
        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // ---------- –ü–û–õ–ù–´–ô –°–ë–†–û–° –ò–ì–†–´ ----------
        function restartGame() {
            // –°–±—Ä–æ—Å –∏–≥—Ä–æ–∫–∞
            player.y = GROUND_Y - PLAYER_SIZE;
            player.velY = 0;
            player.isJumping = false;

            // –°–±—Ä–æ—Å –º–∞—Å—Å–∏–≤–æ–≤
            obstacles = [];
            coins = [];

            // –°–±—Ä–æ—Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            gameSpeed = 5;
            score = 0;
            coinsCollected = 0;
            gameOver = false;
            gameStarted = true;

            // –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–æ–≤ —Å–ø–∞–≤–Ω–∞
            nextObstacleCounter = randomInt(15, 30);
            nextCoinCounter = randomInt(10, 20);

            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä—ã–∂–∫–∞
            jumpPressed = false;
            jumpStartTime = 0;
            spacePressed = false;
            spaceStartTime = 0;

            updateDisplay();
        }

        // ---------- –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê ----------
        function updateDisplay() {
            coinSpan.textContent = coinsCollected;
            scoreSpan.textContent = score;
        }

        // ---------- –ü–†–´–ñ–û–ö –° –ó–ê–î–ê–ù–ù–û–ô –°–ò–õ–û–ô ----------
        function performJump(force) {
            if (!gameStarted) {
                gameStarted = true;
                gameOver = false;
                restartGame();
                return;
            }
            if (gameOver) {
                restartGame();
                return;
            }
            // –ú–æ–∂–Ω–æ –ø—Ä—ã–≥–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∞ –∑–µ–º–ª–µ
            if (!player.isJumping && player.y >= GROUND_Y - PLAYER_SIZE - 1) {
                player.velY = force;
                player.isJumping = true;
            }
        }

        // ---------- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ù–ê–ñ–ê–¢–ò–Ø (–¢–ê–ß–°–ö–†–ò–ù) ----------
        function onJumpStart(e) {
            e.preventDefault();
            jumpPressed = true;
            jumpStartTime = performance.now();
        }

        function onJumpEnd(e) {
            e.preventDefault();
            if (!jumpPressed) return;

            const holdTime = Math.min(performance.now() - jumpStartTime, player.maxHoldTime);
            const powerRange = player.maxJumpPower - player.minJumpPower;
            const force = player.minJumpPower + (powerRange * (holdTime / player.maxHoldTime));
            
            performJump(force);
            jumpPressed = false;
        }

        function onJumpCancel(e) {
            e.preventDefault();
            jumpPressed = false;
        }

        // ---------- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–õ–ê–í–ò–ê–¢–£–†–´ (–ü–†–û–ë–ï–õ) ----------
        function onKeyDown(e) {
            if (e.code === 'Space') {
                e.preventDefault();
                
                // –ù–µ –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤–æ–µ –Ω–∞–∂–∞—Ç–∏–µ, –µ—Å–ª–∏ –ø—Ä–æ–±–µ–ª —É–∂–µ –∑–∞–∂–∞—Ç
                if (!spacePressed) {
                    spacePressed = true;
                    spaceStartTime = performance.now();
                }
            }
        }

        function onKeyUp(e) {
            if (e.code === 'Space') {
                e.preventDefault();
                
                if (spacePressed) {
                    const holdTime = Math.min(performance.now() - spaceStartTime, player.maxHoldTime);
                    const powerRange = player.maxJumpPower - player.minJumpPower;
                    const force = player.minJumpPower + (powerRange * (holdTime / player.maxHoldTime));
                    
                    performJump(force);
                    spacePressed = false;
                }
            }
        }

        // ---------- –°–ü–ê–í–ù –û–ë–™–ï–ö–¢–û–í (–°–õ–£–ß–ê–ô–ù–´–ô –ò–ù–¢–ï–†–í–ê–õ) ----------
        function spawnObstacle() {
            obstacles.push({
                x: canvas.width,
                y: GROUND_Y - OBSTACLE_SIZE,
                width: OBSTACLE_SIZE,
                height: OBSTACLE_SIZE,
                color: '#e74c3c',
                passed: false
            });
        }

        function spawnCoin() {
            coins.push({
                x: canvas.width,
                y: GROUND_Y - COIN_SIZE - 40,
                width: COIN_SIZE,
                height: COIN_SIZE,
                color: '#f1c40f',
                collected: false
            });
        }

        // ---------- –°–¢–û–õ–ö–ù–û–í–ï–ù–ò–Ø ----------
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // ---------- –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ----------
        function update() {
            if (!gameStarted || gameOver) return;

            // ----- –ò–≥—Ä–æ–∫ (—Ñ–∏–∑–∏–∫–∞) -----
            player.velY += player.gravity;
            player.y += player.velY;
            if (player.y > GROUND_Y - PLAYER_SIZE) {
                player.y = GROUND_Y - PLAYER_SIZE;
                player.velY = 0;
                player.isJumping = false;
            }

            // ----- –°–ø–∞–≤–Ω –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π (—Ä–∞–∑–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ) -----
            if (nextObstacleCounter <= 0) {
                spawnObstacle();
                const baseDelay = randomInt(40, 90);
                nextObstacleCounter = Math.floor(baseDelay / (gameSpeed / 3));
            } else {
                nextObstacleCounter--;
            }

            // ----- –°–ø–∞–≤–Ω –º–æ–Ω–µ—Ç -----
            if (nextCoinCounter <= 0) {
                spawnCoin();
                const baseDelay = randomInt(30, 70);
                nextCoinCounter = Math.floor(baseDelay / (gameSpeed / 3.5));
            } else {
                nextCoinCounter--;
            }

            // ----- –î–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π -----
            for (let i = obstacles.length - 1; i >= 0; i--) {
                obstacles[i].x -= gameSpeed;
                if (!obstacles[i].passed && obstacles[i].x + obstacles[i].width < player.x) {
                    obstacles[i].passed = true;
                    score += 20;
                }
                if (obstacles[i].x + obstacles[i].width < 0) obstacles.splice(i, 1);
            }

            // ----- –î–≤–∏–∂–µ–Ω–∏–µ –º–æ–Ω–µ—Ç -----
            for (let i = coins.length - 1; i >= 0; i--) {
                coins[i].x -= gameSpeed;
                if (coins[i].x + coins[i].width < 0) coins.splice(i, 1);
            }

            // ----- –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏ -----
            for (let obs of obstacles) {
                if (checkCollision(
                    {x: player.x, y: player.y, width: PLAYER_SIZE, height: PLAYER_SIZE},
                    {x: obs.x, y: obs.y, width: OBSTACLE_SIZE, height: OBSTACLE_SIZE}
                )) {
                    gameOver = true;
                    break;
                }
            }

            // ----- –°–±–æ—Ä –º–æ–Ω–µ—Ç -----
            for (let i = coins.length - 1; i >= 0; i--) {
                if (checkCollision(
                    {x: player.x, y: player.y, width: PLAYER_SIZE, height: PLAYER_SIZE},
                    {x: coins[i].x, y: coins[i].y, width: COIN_SIZE, height: COIN_SIZE}
                )) {
                    coins.splice(i, 1);
                    coinsCollected++;
                    score += 10;
                }
            }

            // ----- –û—á–∫–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å -----
            score += 1;
            if (score % 500 === 0) gameSpeed += 0.5;

            updateDisplay();
        }

        // ---------- –û–¢–†–ò–°–û–í–ö–ê ----------
        function draw() {
            // –§–æ–Ω
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // –ó–µ–º–ª—è
            ctx.fillStyle = '#27ae60';
            ctx.fillRect(0, GROUND_Y, canvas.width, 20);
            ctx.fillStyle = '#34495e';
            ctx.fillRect(0, GROUND_Y - 2, canvas.width, 2);

            // –ò–≥—Ä–æ–∫
            ctx.fillStyle = player.color;
            ctx.shadowBlur = 10;
            ctx.shadowColor = 'rgba(0,0,0,0.3)';
            ctx.fillRect(player.x, player.y, PLAYER_SIZE, PLAYER_SIZE);
            ctx.fillStyle = 'white';
            ctx.fillRect(player.x + 25, player.y + 10, 8, 8);
            ctx.fillStyle = 'black';
            ctx.fillRect(player.x + 28, player.y + 12, 4, 4);
            ctx.shadowBlur = 0;

            // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            for (let obs of obstacles) {
                ctx.fillStyle = obs.color;
                ctx.fillRect(obs.x, obs.y, OBSTACLE_SIZE, OBSTACLE_SIZE);
                ctx.fillStyle = 'white';
                ctx.fillRect(obs.x + 5, obs.y + 8, 6, 6);
                ctx.fillRect(obs.x + 18, obs.y + 8, 6, 6);
                ctx.fillStyle = 'black';
                ctx.fillRect(obs.x + 7, obs.y + 10, 3, 3);
                ctx.fillRect(obs.x + 20, obs.y + 10, 3, 3);
            }

            // –ú–æ–Ω–µ—Ç—ã
            for (let coin of coins) {
                ctx.fillStyle = coin.color;
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#f1c40f';
                ctx.beginPath();
                ctx.arc(coin.x + COIN_SIZE/2, coin.y + COIN_SIZE/2, COIN_SIZE/2, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(coin.x + COIN_SIZE/2 + 3, coin.y + COIN_SIZE/2 - 3, 3, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            }

            // –≠–∫—Ä–∞–Ω "–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å"
            if (!gameStarted) {
                ctx.fillStyle = 'rgba(0,0,0,0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#f1c40f';
                ctx.font = 'bold 32px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('JUMP RUNNER', canvas.width/2, canvas.height/2 - 50);
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.fillText('üëÜ –ó–∞–∂–º–∏ / –ü–†–û–ë–ï–õ', canvas.width/2, canvas.height/2 + 30);
                ctx.fillText('–¥–ª—è —Å–∏–ª—ã –ø—Ä—ã–∂–∫–∞', canvas.width/2, canvas.height/2 + 70);
            }

            // –≠–∫—Ä–∞–Ω Game Over
            if (gameOver) {
                ctx.fillStyle = 'rgba(0,0,0,0.8)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#e74c3c';
                ctx.font = 'bold 36px Arial';
                ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2 - 60);
                ctx.fillStyle = 'white';
                ctx.font = '24px Arial';
                ctx.fillText(`–°—á–µ—Ç: ${score}`, canvas.width/2, canvas.height/2 + 20);
                ctx.fillText(`–ú–æ–Ω–µ—Ç—ã: ${coinsCollected}`, canvas.width/2, canvas.height/2 + 70);
                ctx.fillStyle = '#3498db';
                ctx.font = '20px Arial';
                ctx.fillText('–ó–∞–∂–º–∏ / –ü–†–û–ë–ï–õ, —á—Ç–æ–±—ã —Å—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞', canvas.width/2, canvas.height/2 + 150);
            }
        }

        // ---------- –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ----------
        function gameLoop() {
            update();
            draw();
            animationId = requestAnimationFrame(gameLoop);
        }

        // ---------- –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í ----------
        // –¢–∞—á—Å–∫—Ä–∏–Ω
        canvas.addEventListener('touchstart', onJumpStart);
        canvas.addEventListener('touchend', onJumpEnd);
        canvas.addEventListener('touchcancel', onJumpCancel);
        canvas.addEventListener('touchmove', (e) => e.preventDefault());

        // –ú—ã—à—å
        canvas.addEventListener('mousedown', onJumpStart);
        canvas.addEventListener('mouseup', onJumpEnd);
        canvas.addEventListener('mouseleave', onJumpCancel);

        // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (–ø—Ä–æ–±–µ–ª)
        window.addEventListener('keydown', onKeyDown);
        window.addEventListener('keyup', onKeyUp);
        
        // –ó–∞–ø—Ä–µ—Ç —Å–∫—Ä–æ–ª–ª–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø—Ä–æ–±–µ–ª–∞ (–¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
        window.addEventListener('keydown', function(e) {
            if (e.code === 'Space' || e.key === ' ' || e.keyCode === 32) {
                e.preventDefault();
            }
        }, false);

        // –ö–Ω–æ–ø–∫–∞ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
        restartBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            restartGame();
        });

        // –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞
        gameLoop();
    </script>
</body>
</html>
