<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jump Runner ‚Äî –≤—ã—Å–æ–∫–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è, —Ä–µ–¥–∫–∏–µ, —Ä–∞–∑–Ω–∞—è –≤—ã—Å–æ—Ç–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
            touch-action: pan-y;
        }
        .game-container {
            background: #2c3e50;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            max-width: 450px;
            width: 100%;
        }
        canvas {
            display: block;
            width: 100%;
            height: auto;
            border-radius: 10px;
            cursor: pointer;
            touch-action: none;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            color: white;
        }
        .scores {
            display: flex;
            gap: 30px;
            font-size: 18px;
            font-weight: bold;
        }
        .restart-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            touch-action: manipulation;
            box-shadow: 0 4px 0 #c0392b;
        }
        .restart-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }
        .instructions {
            color: #bdc3c7;
            margin-top: 10px;
            font-size: 14px;
            text-align: center;
        }
        @media (max-width: 600px) {
            .game-container { padding: 10px; }
            .scores { font-size: 16px; gap: 20px; }
            .restart-btn { padding: 8px 20px; font-size: 14px; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="gameCanvas" width="400" height="600"></canvas>
        <div class="controls">
            <div class="scores">
                <div>üí∞ <span id="coinCount">0</span></div>
                <div>üèÜ <span id="scoreCount">0</span></div>
            </div>
            <button class="restart-btn" id="restartBtn">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>
        <div class="instructions">
            üëÜ –ó–∞–∂–º–∏ —ç–∫—Ä–∞–Ω / –ü–†–û–ë–ï–õ ‚Äî —Å–∏–ª–∞ –ø—Ä—ã–∂–∫–∞ | –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è —Ä–µ–¥–∫–∏–µ –∏ —Ä–∞–∑–Ω–æ–π –≤—ã—Å–æ—Ç—ã!
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const coinSpan = document.getElementById('coinCount');
        const scoreSpan = document.getElementById('scoreCount');
        const restartBtn = document.getElementById('restartBtn');

        // ---------- –ù–ê–°–¢–†–û–ô–ö–ò ----------
        const GROUND_Y = 500;
        const PLAYER_SIZE = 40;
        const OBSTACLE_WIDTH = 30;
        const OBSTACLE_HEIGHT_NORMAL = 30;    // –æ–±—ã—á–Ω–∞—è –≤—ã—Å–æ—Ç–∞
        const OBSTACLE_HEIGHT_TALL = 60;       // –≤—ã—Å–æ–∫–∞—è –≤—ã—Å–æ—Ç–∞ (–≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ)
        const COIN_SIZE = 20;

        // ---------- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–û–ö–ê ----------
        let player = {
            x: 50, y: GROUND_Y - PLAYER_SIZE,
            width: PLAYER_SIZE, height: PLAYER_SIZE,
            velY: 0, gravity: 0.5,
            minJumpPower: -9,
            maxJumpPower: -17,
            maxHoldTime: 600,
            isJumping: false,
            color: '#3498db'
        };

        // ---------- –ò–ì–†–û–í–´–ï –û–ë–™–ï–ö–¢–´ ----------
        let obstacles = [];
        let coins = [];
        let gameSpeed = 5;
        let score = 0;
        let coinsCollected = 0;
        let gameOver = false;
        let gameStarted = false;
        let animationId = null;

        // ---------- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –°–õ–£–ß–ê–ô–ù–û–ì–û –°–ü–ê–í–ù–ê ----------
        let nextObstacleCounter = 0;
        let nextCoinCounter = 0;

        // ---------- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –ó–ê–†–Ø–î–ö–ò –ü–†–´–ñ–ö–ê ----------
        let jumpPressed = false;
        let jumpStartTime = 0;
        let spacePressed = false;
        let spaceStartTime = 0;

        // ---------- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ----------
        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // ---------- –ü–û–õ–ù–´–ô –°–ë–†–û–° –ò–ì–†–´ ----------
        function restartGame() {
            player.y = GROUND_Y - PLAYER_SIZE;
            player.velY = 0;
            player.isJumping = false;

            obstacles = [];
            coins = [];

            gameSpeed = 5;
            score = 0;
            coinsCollected = 0;
            gameOver = false;
            gameStarted = true;

            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏, —á—Ç–æ–±—ã –ø–µ—Ä–≤–æ–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ –Ω–µ –ø—Ä–∏—à–ª–æ —Å—Ä–∞–∑—É
            nextObstacleCounter = randomInt(40, 70);
            nextCoinCounter = randomInt(20, 40);

            jumpPressed = false;
            jumpStartTime = 0;
            spacePressed = false;
            spaceStartTime = 0;

            updateDisplay();
        }

        function updateDisplay() {
            coinSpan.textContent = coinsCollected;
            scoreSpan.textContent = score;
        }

        function performJump(force) {
            if (!gameStarted) {
                gameStarted = true;
                gameOver = false;
                restartGame();
                return;
            }
            if (gameOver) {
                restartGame();
                return;
            }
            if (!player.isJumping && player.y >= GROUND_Y - PLAYER_SIZE - 1) {
                player.velY = force;
                player.isJumping = true;
            }
        }

        // ---------- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –¢–ê–ß–°–ö–†–ò–ù ----------
        function onJumpStart(e) {
            e.preventDefault();
            jumpPressed = true;
            jumpStartTime = performance.now();
        }

        function onJumpEnd(e) {
            e.preventDefault();
            if (!jumpPressed) return;

            const holdTime = Math.min(performance.now() - jumpStartTime, player.maxHoldTime);
            const powerRange = player.maxJumpPower - player.minJumpPower;
            const force = player.minJumpPower + (powerRange * (holdTime / player.maxHoldTime));
            
            performJump(force);
            jumpPressed = false;
        }

        function onJumpCancel(e) {
            e.preventDefault();
            jumpPressed = false;
        }

        // ---------- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–õ–ê–í–ò–ê–¢–£–†–´ ----------
        function onKeyDown(e) {
            if (e.code === 'Space') {
                e.preventDefault();
                if (!spacePressed) {
                    spacePressed = true;
                    spaceStartTime = performance.now();
                }
            }
        }

        function onKeyUp(e) {
            if (e.code === 'Space') {
                e.preventDefault();
                if (spacePressed) {
                    const holdTime = Math.min(performance.now() - spaceStartTime, player.maxHoldTime);
                    const powerRange = player.maxJumpPower - player.minJumpPower;
                    const force = player.minJumpPower + (powerRange * (holdTime / player.maxHoldTime));
                    performJump(force);
                    spacePressed = false;
                }
            }
        }

        // ---------- –°–ü–ê–í–ù –ü–†–ï–ü–Ø–¢–°–¢–í–ò–ô (–†–ï–î–ö–ò–ï, –†–ê–ó–ù–ê–Ø –í–´–°–û–¢–ê) ----------
        function spawnObstacle() {
            // 70% - –æ–±—ã—á–Ω—ã–µ, 30% - –≤—ã—Å–æ–∫–∏–µ
            const isTall = Math.random() < 0.3;
            const height = isTall ? OBSTACLE_HEIGHT_TALL : OBSTACLE_HEIGHT_NORMAL;
            
            obstacles.push({
                x: canvas.width,
                y: GROUND_Y - height,  // –Ω–∏–∑ –ø—Ä–∏–∂–∞—Ç –∫ –∑–µ–º–ª–µ
                width: OBSTACLE_WIDTH,
                height: height,
                color: isTall ? '#c0392b' : '#e74c3c', // –≤—ã—Å–æ–∫–∏–µ —Ç–µ–º–Ω–µ–µ
                passed: false,
                isTall: isTall
            });
        }

        function spawnCoin() {
            coins.push({
                x: canvas.width,
                y: GROUND_Y - COIN_SIZE - 40,
                width: COIN_SIZE,
                height: COIN_SIZE,
                color: '#f1c40f',
                collected: false
            });
        }

        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // ---------- –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ----------
        function update() {
            if (!gameStarted || gameOver) return;

            // ----- –ò–≥—Ä–æ–∫ -----
            player.velY += player.gravity;
            player.y += player.velY;
            if (player.y > GROUND_Y - PLAYER_SIZE) {
                player.y = GROUND_Y - PLAYER_SIZE;
                player.velY = 0;
                player.isJumping = false;
            }

            // ----- –°–ü–ê–í–ù –ü–†–ï–ü–Ø–¢–°–¢–í–ò–ô (–ë–û–õ–¨–®–û–ï –†–ê–°–°–¢–û–Ø–ù–ò–ï) -----
            if (nextObstacleCounter <= 0) {
                spawnObstacle();
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª: —Ç–µ–ø–µ—Ä—å –æ—Ç 80 –¥–æ 140 –∫–∞–¥—Ä–æ–≤ (–±—ã–ª–æ 40-90)
                const baseDelay = randomInt(80, 140);
                // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏–≥—Ä—ã, –Ω–æ –Ω–µ –¥–∞—ë–º —Å—Ç–∞—Ç—å —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–º
                nextObstacleCounter = Math.max(40, Math.floor(baseDelay / (gameSpeed / 3)));
            } else {
                nextObstacleCounter--;
            }

            // ----- –°–ø–∞–≤–Ω –º–æ–Ω–µ—Ç (—á—É—Ç—å —Ä–µ–∂–µ) -----
            if (nextCoinCounter <= 0) {
                spawnCoin();
                const baseDelay = randomInt(40, 90);
                nextCoinCounter = Math.floor(baseDelay / (gameSpeed / 3.5));
            } else {
                nextCoinCounter--;
            }

            // ----- –î–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π -----
            for (let i = obstacles.length - 1; i >= 0; i--) {
                obstacles[i].x -= gameSpeed;
                
                // –ë–æ–Ω—É—Å –∑–∞ —É—Å–ø–µ—à–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ
                if (!obstacles[i].passed && obstacles[i].x + obstacles[i].width < player.x) {
                    obstacles[i].passed = true;
                    // –í—ã—Å–æ–∫–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –¥–∞—é—Ç –±–æ–ª—å—à–µ –æ—á–∫–æ–≤
                    score += obstacles[i].isTall ? 30 : 20;
                }
                
                if (obstacles[i].x + obstacles[i].width < 0) obstacles.splice(i, 1);
            }

            // ----- –î–≤–∏–∂–µ–Ω–∏–µ –º–æ–Ω–µ—Ç -----
            for (let i = coins.length - 1; i >= 0; i--) {
                coins[i].x -= gameSpeed;
                if (coins[i].x + coins[i].width < 0) coins.splice(i, 1);
            }

            // ----- –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏ -----
            for (let obs of obstacles) {
                if (checkCollision(
                    {x: player.x, y: player.y, width: PLAYER_SIZE, height: PLAYER_SIZE},
                    {x: obs.x, y: obs.y, width: obs.width, height: obs.height}
                )) {
                    gameOver = true;
                    break;
                }
            }

            // ----- –°–±–æ—Ä –º–æ–Ω–µ—Ç -----
            for (let i = coins.length - 1; i >= 0; i--) {
                if (checkCollision(
                    {x: player.x, y: player.y, width: PLAYER_SIZE, height: PLAYER_SIZE},
                    {x: coins[i].x, y: coins[i].y, width: COIN_SIZE, height: COIN_SIZE}
                )) {
                    coins.splice(i, 1);
                    coinsCollected++;
                    score += 10;
                }
            }

            // ----- –û—á–∫–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å -----
            score += 1;
            if (score % 500 === 0) gameSpeed += 0.5;

            updateDisplay();
        }

        // ---------- –û–¢–†–ò–°–û–í–ö–ê ----------
        function draw() {
            // –§–æ–Ω
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // –ó–µ–º–ª—è
            ctx.fillStyle = '#27ae60';
            ctx.fillRect(0, GROUND_Y, canvas.width, 20);
            ctx.fillStyle = '#34495e';
            ctx.fillRect(0, GROUND_Y - 2, canvas.width, 2);

            // –ò–≥—Ä–æ–∫
            ctx.fillStyle = player.color;
            ctx.shadowBlur = 10;
            ctx.shadowColor = 'rgba(0,0,0,0.3)';
            ctx.fillRect(player.x, player.y, PLAYER_SIZE, PLAYER_SIZE);
            ctx.fillStyle = 'white';
            ctx.fillRect(player.x + 25, player.y + 10, 8, 8);
            ctx.fillStyle = 'black';
            ctx.fillRect(player.x + 28, player.y + 12, 4, 4);
            ctx.shadowBlur = 0;

            // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è (—Ä–∞–∑–Ω–æ–π –≤—ã—Å–æ—Ç—ã)
            for (let obs of obstacles) {
                ctx.fillStyle = obs.color;
                ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
                
                // –ì–ª–∞–∑–∫–∏ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π, –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö —Å–¥–≤–∏–≥–∞–µ–º
                ctx.fillStyle = 'white';
                if (obs.isTall) {
                    ctx.fillRect(obs.x + 5, obs.y + 15, 6, 6);
                    ctx.fillRect(obs.x + 18, obs.y + 15, 6, 6);
                    ctx.fillStyle = 'black';
                    ctx.fillRect(obs.x + 7, obs.y + 17, 3, 3);
                    ctx.fillRect(obs.x + 20, obs.y + 17, 3, 3);
                } else {
                    ctx.fillRect(obs.x + 5, obs.y + 8, 6, 6);
                    ctx.fillRect(obs.x + 18, obs.y + 8, 6, 6);
                    ctx.fillStyle = 'black';
                    ctx.fillRect(obs.x + 7, obs.y + 10, 3, 3);
                    ctx.fillRect(obs.x + 20, obs.y + 10, 3, 3);
                }
            }

            // –ú–æ–Ω–µ—Ç—ã
            for (let coin of coins) {
                ctx.fillStyle = coin.color;
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#f1c40f';
                ctx.beginPath();
                ctx.arc(coin.x + COIN_SIZE/2, coin.y + COIN_SIZE/2, COIN_SIZE/2, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(coin.x + COIN_SIZE/2 + 3, coin.y + COIN_SIZE/2 - 3, 3, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            }

            // –≠–∫—Ä–∞–Ω —Å—Ç–∞—Ä—Ç–∞
            if (!gameStarted) {
                ctx.fillStyle = 'rgba(0,0,0,0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#f1c40f';
                ctx.font = 'bold 32px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('JUMP RUNNER', canvas.width/2, canvas.height/2 - 50);
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.fillText('üëÜ –ó–∞–∂–º–∏ / –ü–†–û–ë–ï–õ', canvas.width/2, canvas.height/2 + 30);
                ctx.fillText('–ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è —Ä–µ–¥–∫–∏–µ –∏ –≤—ã—Å–æ–∫–∏–µ!', canvas.width/2, canvas.height/2 + 70);
            }

            // –≠–∫—Ä–∞–Ω Game Over
            if (gameOver) {
                ctx.fillStyle = 'rgba(0,0,0,0.8)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#e74c3c';
                ctx.font = 'bold 36px Arial';
                ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2 - 60);
                ctx.fillStyle = 'white';
                ctx.font = '24px Arial';
                ctx.fillText(`–°—á–µ—Ç: ${score}`, canvas.width/2, canvas.height/2 + 20);
                ctx.fillText(`–ú–æ–Ω–µ—Ç—ã: ${coinsCollected}`, canvas.width/2, canvas.height/2 + 70);
                ctx.fillStyle = '#3498db';
                ctx.font = '20px Arial';
                ctx.fillText('–ó–∞–∂–º–∏ / –ü–†–û–ë–ï–õ –¥–ª—è —Ä–µ—Å—Ç–∞—Ä—Ç–∞', canvas.width/2, canvas.height/2 + 150);
            }
        }

        function gameLoop() {
            update();
            draw();
            animationId = requestAnimationFrame(gameLoop);
        }

        // ---------- –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í ----------
        canvas.addEventListener('touchstart', onJumpStart);
        canvas.addEventListener('touchend', onJumpEnd);
        canvas.addEventListener('touchcancel', onJumpCancel);
        canvas.addEventListener('touchmove', (e) => e.preventDefault());

        canvas.addEventListener('mousedown', onJumpStart);
        canvas.addEventListener('mouseup', onJumpEnd);
        canvas.addEventListener('mouseleave', onJumpCancel);

        window.addEventListener('keydown', onKeyDown);
        window.addEventListener('keyup', onKeyUp);
        
        window.addEventListener('keydown', function(e) {
            if (e.code === 'Space' || e.key === ' ' || e.keyCode === 32) {
                e.preventDefault();
            }
        }, false);

        restartBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            restartGame();
        });

        gameLoop();
    </script>
</body>
</html>
