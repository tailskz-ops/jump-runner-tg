<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jump Runner ‚Äî —É–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø—Ä—ã–∂–∫–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
            touch-action: pan-y;
        }
        .game-container {
            background: #2c3e50;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            max-width: 450px;
            width: 100%;
        }
        canvas {
            display: block;
            width: 100%;
            height: auto;
            border-radius: 10px;
            cursor: pointer;
            touch-action: none;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            color: white;
        }
        .scores {
            display: flex;
            gap: 30px;
            font-size: 18px;
            font-weight: bold;
        }
        .lives {
            display: flex;
            gap: 5px;
            font-size: 24px;
        }
        .restart-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            touch-action: manipulation;
            box-shadow: 0 4px 0 #c0392b;
        }
        .restart-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }
        .instructions {
            color: #bdc3c7;
            margin-top: 10px;
            font-size: 14px;
            text-align: center;
        }
        @media (max-width: 600px) {
            .game-container { padding: 10px; }
            .scores { font-size: 16px; gap: 20px; }
            .restart-btn { padding: 8px 20px; font-size: 14px; }
            .lives { font-size: 20px; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="gameCanvas" width="400" height="600"></canvas>
        <div class="controls">
            <div class="lives" id="livesDisplay">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
            <div class="scores">
                <div>üí∞ <span id="coinCount">0</span></div>
                <div>üèÜ <span id="scoreCount">0</span></div>
            </div>
            <button class="restart-btn" id="restartBtn">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>
        <div class="instructions">
            üëÜ –ó–∞–∂–º–∏ / –ü–†–û–ë–ï–õ ‚Äî –£–í–ï–õ–ò–ß–ï–ù–ù–ê–Ø –°–ò–õ–ê –ü–†–´–ñ–ö–ê! | ‚ù§Ô∏è 3 –∂–∏–∑–Ω–∏ | –°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞—Å—Ç—ë—Ç –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const coinSpan = document.getElementById('coinCount');
        const scoreSpan = document.getElementById('scoreCount');
        const livesDisplay = document.getElementById('livesDisplay');
        const restartBtn = document.getElementById('restartBtn');

        // ---------- –ù–ê–°–¢–†–û–ô–ö–ò ----------
        const GROUND_Y = 500;
        const PLAYER_SIZE = 40;
        const OBSTACLE_WIDTH = 30;
        const OBSTACLE_HEIGHT_NORMAL = 30;
        const OBSTACLE_HEIGHT_TALL = 60;
        const COIN_SIZE = 20;

        // ---------- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–û–ö–ê ----------
        let player = {
            x: 50, y: GROUND_Y - PLAYER_SIZE,
            width: PLAYER_SIZE, height: PLAYER_SIZE,
            velY: 0, gravity: 0.5,
            // ‚ö° –£–í–ï–õ–ò–ß–ï–ù–ù–ê–Ø –°–ö–û–†–û–°–¢–¨ –ü–†–´–ñ–ö–ê
            minJumpPower: -11,     // –±—ã–ª–æ -9, —Ç–µ–ø–µ—Ä—å -11 (–≤—ã—à–µ)
            maxJumpPower: -19,    // –±—ã–ª–æ -17, —Ç–µ–ø–µ—Ä—å -19 (–µ—â—ë –≤—ã—à–µ)
            maxHoldTime: 600,
            isJumping: false,
            color: '#3498db',
            invincible: false,
            invincibleTimer: 0,
            blinkTimer: 0
        };

        // ---------- –ò–ì–†–û–í–´–ï –û–ë–™–ï–ö–¢–´ ----------
        let obstacles = [];
        let coins = [];
        
        // ---------- –ü–ê–†–ê–ú–ï–¢–†–´ –ò–ì–†–´ ----------
        let gameSpeed = 4;
        let score = 0;
        let coinsCollected = 0;
        let lives = 3;
        let gameOver = false;
        let gameStarted = false;
        let animationId = null;

        // ---------- –¢–ê–ô–ú–ï–† –°–ö–û–†–û–°–¢–ò (60 –°–ï–ö–£–ù–î = 3600 –ö–ê–î–†–û–í) ----------
        let speedTimer = 0;
        const SPEED_INCREASE_INTERVAL = 3600;
        let currentSpeedLevel = 1;

        // ---------- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –°–ü–ê–í–ù–ê ----------
        let nextObstacleCounter = 0;
        let nextCoinCounter = 0;

        // ---------- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –ó–ê–†–Ø–î–ö–ò –ü–†–´–ñ–ö–ê ----------
        let jumpPressed = false;
        let jumpStartTime = 0;
        let spacePressed = false;
        let spaceStartTime = 0;

        // ---------- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ----------
        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function updateLivesDisplay() {
            let hearts = '';
            for (let i = 0; i < lives; i++) hearts += '‚ù§Ô∏è';
            for (let i = lives; i < 3; i++) hearts += 'üñ§';
            livesDisplay.textContent = hearts;
        }

        function restartGame() {
            player.y = GROUND_Y - PLAYER_SIZE;
            player.velY = 0;
            player.isJumping = false;
            player.invincible = false;
            player.invincibleTimer = 0;

            obstacles = [];
            coins = [];

            gameSpeed = 4;
            speedTimer = 0;
            currentSpeedLevel = 1;
            
            score = 0;
            coinsCollected = 0;
            lives = 3;
            gameOver = false;
            gameStarted = true;

            nextObstacleCounter = randomInt(40, 70);
            nextCoinCounter = randomInt(20, 40);

            jumpPressed = false;
            spacePressed = false;

            updateDisplay();
            updateLivesDisplay();
        }

        function updateDisplay() {
            coinSpan.textContent = coinsCollected;
            scoreSpan.textContent = score;
        }

        function performJump(force) {
            if (!gameStarted) {
                gameStarted = true;
                gameOver = false;
                restartGame();
                return;
            }
            if (gameOver) return;
            if (!player.isJumping && player.y >= GROUND_Y - PLAYER_SIZE - 1) {
                player.velY = force;
                player.isJumping = true;
            }
        }

        function takeDamage() {
            if (player.invincible || gameOver) return false;
            
            lives--;
            updateLivesDisplay();
            
            if (lives <= 0) {
                gameOver = true;
                return true;
            }
            
            player.invincible = true;
            player.invincibleTimer = 120;
            player.blinkTimer = 0;
            
            return true;
        }

        // ---------- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ----------
        function onJumpStart(e) {
            e.preventDefault();
            jumpPressed = true;
            jumpStartTime = performance.now();
        }

        function onJumpEnd(e) {
            e.preventDefault();
            if (!jumpPressed) return;

            const holdTime = Math.min(performance.now() - jumpStartTime, player.maxHoldTime);
            const powerRange = player.maxJumpPower - player.minJumpPower;
            const force = player.minJumpPower + (powerRange * (holdTime / player.maxHoldTime));
            
            performJump(force);
            jumpPressed = false;
        }

        function onJumpCancel(e) {
            e.preventDefault();
            jumpPressed = false;
        }

        function onKeyDown(e) {
            if (e.code === 'Space') {
                e.preventDefault();
                if (!spacePressed) {
                    spacePressed = true;
                    spaceStartTime = performance.now();
                }
            }
        }

        function onKeyUp(e) {
            if (e.code === 'Space') {
                e.preventDefault();
                if (spacePressed) {
                    const holdTime = Math.min(performance.now() - spaceStartTime, player.maxHoldTime);
                    const powerRange = player.maxJumpPower - player.minJumpPower;
                    const force = player.minJumpPower + (powerRange * (holdTime / player.maxHoldTime));
                    performJump(force);
                    spacePressed = false;
                }
            }
        }

        // ---------- –£–ú–ù–´–ô –°–ü–ê–í–ù –ú–û–ù–ï–¢ ----------
        function spawnCoin() {
            if (obstacles.length > 3) return;
            
            let safeY = GROUND_Y - COIN_SIZE - 40;
            let attempts = 0;
            let foundSafe = false;
            
            while (!foundSafe && attempts < 10) {
                attempts++;
                
                const rand = Math.random();
                if (rand < 0.4) {
                    safeY = GROUND_Y - COIN_SIZE - 20;
                } else if (rand < 0.7) {
                    safeY = GROUND_Y - COIN_SIZE - 70;
                } else {
                    safeY = GROUND_Y - COIN_SIZE - 120;
                }
                
                foundSafe = true;
                for (let obs of obstacles) {
                    if (Math.abs(obs.x - canvas.width) < 100 && 
                        Math.abs(obs.y - safeY) < 40) {
                        foundSafe = false;
                        break;
                    }
                }
            }
            
            coins.push({
                x: canvas.width,
                y: safeY,
                width: COIN_SIZE,
                height: COIN_SIZE,
                color: '#f1c40f',
                collected: false
            });
        }

        function spawnObstacle() {
            const isTall = Math.random() < 0.3;
            const height = isTall ? OBSTACLE_HEIGHT_TALL : OBSTACLE_HEIGHT_NORMAL;
            
            obstacles.push({
                x: canvas.width,
                y: GROUND_Y - height,
                width: OBSTACLE_WIDTH,
                height: height,
                color: isTall ? '#c0392b' : '#e74c3c',
                passed: false,
                isTall: isTall
            });
        }

        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // ---------- –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ----------
        function update() {
            if (!gameStarted || gameOver) return;

            // ----- –¢–ê–ô–ú–ï–† –°–ö–û–†–û–°–¢–ò -----
            speedTimer++;
            if (speedTimer >= SPEED_INCREASE_INTERVAL) {
                speedTimer = 0;
                gameSpeed += 0.5;
                currentSpeedLevel++;
            }

            if (player.invincible) {
                player.invincibleTimer--;
                player.blinkTimer++;
                if (player.invincibleTimer <= 0) {
                    player.invincible = false;
                }
            }

            // ----- –§–ò–ó–ò–ö–ê –ò–ì–†–û–ö–ê -----
            player.velY += player.gravity;
            player.y += player.velY;
            if (player.y > GROUND_Y - PLAYER_SIZE) {
                player.y = GROUND_Y - PLAYER_SIZE;
                player.velY = 0;
                player.isJumping = false;
            }

            // ----- –°–ü–ê–í–ù –ü–†–ï–ü–Ø–¢–°–¢–í–ò–ô -----
            if (nextObstacleCounter <= 0) {
                spawnObstacle();
                const baseDelay = randomInt(90, 150);
                nextObstacleCounter = Math.max(50, Math.floor(baseDelay / (gameSpeed / 3)));
            } else {
                nextObstacleCounter--;
            }

            // ----- –°–ü–ê–í–ù –ú–û–ù–ï–¢ -----
            if (nextCoinCounter <= 0) {
                spawnCoin();
                const baseDelay = randomInt(50, 100);
                nextCoinCounter = Math.floor(baseDelay / (gameSpeed / 3.5));
            } else {
                nextCoinCounter--;
            }

            // ----- –î–í–ò–ñ–ï–ù–ò–ï –ü–†–ï–ü–Ø–¢–°–¢–í–ò–ô -----
            for (let i = obstacles.length - 1; i >= 0; i--) {
                obstacles[i].x -= gameSpeed;
                
                if (!obstacles[i].passed && obstacles[i].x + obstacles[i].width < player.x) {
                    obstacles[i].passed = true;
                    score += obstacles[i].isTall ? 30 : 20;
                }
                
                if (obstacles[i].x + obstacles[i].width < 0) obstacles.splice(i, 1);
            }

            // ----- –î–í–ò–ñ–ï–ù–ò–ï –ú–û–ù–ï–¢ -----
            for (let i = coins.length - 1; i >= 0; i--) {
                coins[i].x -= gameSpeed;
                if (coins[i].x + coins[i].width < 0) coins.splice(i, 1);
            }

            // ----- –°–¢–û–õ–ö–ù–û–í–ï–ù–ò–Ø (–¢–û–õ–¨–ö–û –ù–ï –í –ù–ï–£–Ø–ó–í–ò–ú–û–°–¢–ò) -----
            if (!player.invincible) {
                for (let i = obstacles.length - 1; i >= 0; i--) {
                    const obs = obstacles[i];
                    if (checkCollision(
                        {x: player.x, y: player.y, width: PLAYER_SIZE, height: PLAYER_SIZE},
                        {x: obs.x, y: obs.y, width: obs.width, height: obs.height}
                    )) {
                        takeDamage();
                        obstacles.splice(i, 1);
                        break;
                    }
                }
            }

            // ----- –°–ë–û–† –ú–û–ù–ï–¢ -----
            for (let i = coins.length - 1; i >= 0; i--) {
                if (checkCollision(
                    {x: player.x, y: player.y, width: PLAYER_SIZE, height: PLAYER_SIZE},
                    {x: coins[i].x, y: coins[i].y, width: COIN_SIZE, height: COIN_SIZE}
                )) {
                    coins.splice(i, 1);
                    coinsCollected++;
                    score += 10;
                }
            }

            score += 1;
            updateDisplay();
        }

        // ---------- –û–¢–†–ò–°–û–í–ö–ê ----------
        function draw() {
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#27ae60';
            ctx.fillRect(0, GROUND_Y, canvas.width, 20);
            ctx.fillStyle = '#34495e';
            ctx.fillRect(0, GROUND_Y - 2, canvas.width, 2);

            // –ò–ì–†–û–ö –° –ú–ò–ì–ê–ù–ò–ï–ú
            if (!player.invincible || (player.invincible && Math.floor(player.blinkTimer / 10) % 2 === 0)) {
                ctx.fillStyle = player.color;
                ctx.shadowBlur = 10;
                ctx.shadowColor = 'rgba(0,0,0,0.3)';
                ctx.fillRect(player.x, player.y, PLAYER_SIZE, PLAYER_SIZE);
                ctx.fillStyle = 'white';
                ctx.fillRect(player.x + 25, player.y + 10, 8, 8);
                ctx.fillStyle = 'black';
                ctx.fillRect(player.x + 28, player.y + 12, 4, 4);
                ctx.shadowBlur = 0;
            }

            // –ü–†–ï–ü–Ø–¢–°–¢–í–ò–Ø
            for (let obs of obstacles) {
                ctx.fillStyle = obs.color;
                ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
                
                ctx.fillStyle = 'white';
                if (obs.isTall) {
                    ctx.fillRect(obs.x + 5, obs.y + 15, 6, 6);
                    ctx.fillRect(obs.x + 18, obs.y + 15, 6, 6);
                    ctx.fillStyle = 'black';
                    ctx.fillRect(obs.x + 7, obs.y + 17, 3, 3);
                    ctx.fillRect(obs.x + 20, obs.y + 17, 3, 3);
                } else {
                    ctx.fillRect(obs.x + 5, obs.y + 8, 6, 6);
                    ctx.fillRect(obs.x + 18, obs.y + 8, 6, 6);
                    ctx.fillStyle = 'black';
                    ctx.fillRect(obs.x + 7, obs.y + 10, 3, 3);
                    ctx.fillRect(obs.x + 20, obs.y + 10, 3, 3);
                }
            }

            // –ú–û–ù–ï–¢–´
            for (let coin of coins) {
                ctx.fillStyle = coin.color;
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#f1c40f';
                ctx.beginPath();
                ctx.arc(coin.x + COIN_SIZE/2, coin.y + COIN_SIZE/2, COIN_SIZE/2, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(coin.x + COIN_SIZE/2 + 3, coin.y + COIN_SIZE/2 - 3, 3, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            }

            // –ò–ù–¢–ï–†–§–ï–ô–°
            ctx.fillStyle = 'white';
            ctx.font = '14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`‚ö° –°–∫–æ—Ä–æ—Å—Ç—å: ${currentSpeedLevel}`, 10, 50);
            
            const secondsToNext = Math.floor((SPEED_INCREASE_INTERVAL - speedTimer) / 60);
            ctx.fillText(`‚è±Ô∏è +0.5 —á–µ—Ä–µ–∑ ${secondsToNext}—Å`, 10, 80);

            // –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù
            if (!gameStarted) {
                ctx.fillStyle = 'rgba(0,0,0,0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#f1c40f';
                ctx.font = 'bold 32px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('JUMP RUNNER', canvas.width/2, canvas.height/2 - 70);
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.fillText('üëÜ –ó–∞–∂–º–∏ / –ü–†–û–ë–ï–õ', canvas.width/2, canvas.height/2 + 20);
                ctx.fillText('‚ö° –£–í–ï–õ–ò–ß–ï–ù–ù–ê–Ø –°–ò–õ–ê –ü–†–´–ñ–ö–ê!', canvas.width/2, canvas.height/2 + 60);
                ctx.fillText('‚ù§Ô∏è 3 –∂–∏–∑–Ω–∏ | –°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞—Å—Ç—ë—Ç', canvas.width/2, canvas.height/2 + 100);
            }

            // GAME OVER
            if (gameOver) {
                ctx.fillStyle = 'rgba(0,0,0,0.9)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#e74c3c';
                ctx.font = 'bold 36px Arial';
                ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2 - 70);
                ctx.fillStyle = 'white';
                ctx.font = '24px Arial';
                ctx.fillText(`–°—á–µ—Ç: ${score}`, canvas.width/2, canvas.height/2 + 10);
                ctx.fillText(`–ú–æ–Ω–µ—Ç—ã: ${coinsCollected}`, canvas.width/2, canvas.height/2 + 60);
                ctx.fillStyle = '#f1c40f';
                ctx.font = '20px Arial';
                ctx.fillText(`–°–∫–æ—Ä–æ—Å—Ç—å: ${currentSpeedLevel}`, canvas.width/2, canvas.height/2 + 120);
                ctx.fillStyle = '#3498db';
                ctx.font = '20px Arial';
                ctx.fillText('–ù–∞–∂–º–∏ –ù–æ–≤–∞—è –∏–≥—Ä–∞', canvas.width/2, canvas.height/2 + 180);
            }
        }

        function gameLoop() {
            update();
            draw();
            animationId = requestAnimationFrame(gameLoop);
        }

        // ---------- –ü–û–î–ü–ò–°–ö–ê –ù–ê –°–û–ë–´–¢–ò–Ø ----------
        canvas.addEventListener('touchstart', onJumpStart);
        canvas.addEventListener('touchend', onJumpEnd);
        canvas.addEventListener('touchcancel', onJumpCancel);
        canvas.addEventListener('touchmove', (e) => e.preventDefault());

        canvas.addEventListener('mousedown', onJumpStart);
        canvas.addEventListener('mouseup', onJumpEnd);
        canvas.addEventListener('mouseleave', onJumpCancel);

        window.addEventListener('keydown', onKeyDown);
        window.addEventListener('keyup', onKeyUp);
        
        window.addEventListener('keydown', function(e) {
            if (e.code === 'Space' || e.key === ' ' || e.keyCode === 32) {
                e.preventDefault();
            }
        }, false);

        restartBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            restartGame();
        });

        updateLivesDisplay();
        gameLoop();
    </script>
</body>
</html>
