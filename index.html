<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Jump Runner ‚Äî Telegram Mini App</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { background: var(--tg-theme-bg-color, #2c3e50); display: flex; justify-content: center; align-items: center; min-height: 100vh; font-family: Arial, sans-serif; touch-action: pan-y; }
        .game-wrapper { display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 450px; padding: 12px; }
        canvas { display: block; width: 100%; height: auto; border-radius: 16px; touch-action: none; background: var(--tg-theme-secondary-bg-color, #34495e); }
        .vpn-warning { background: #e74c3c; color: white; padding: 10px; border-radius: 8px; margin-top: 10px; text-align: center; display: none; }
        .stats-panel { display: flex; justify-content: space-between; width: 100%; margin-top: 16px; padding: 12px 20px; background: var(--tg-theme-section-bg-color, #34495e); border-radius: 30px; color: white; }
        .restart-btn { background: #e74c3c; color: white; border: none; padding: 10px 25px; border-radius: 25px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div class="vpn-warning" id="vpnWarning">üåç –í–∫–ª—é—á–∏—Ç–µ VPN ‚Äî –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ Mini App –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è</div>
        <canvas id="gameCanvas" width="400" height="600"></canvas>
        <div class="stats-panel">
            <div>üí∞ <span id="coinCount">0</span></div>
            <div>üèÜ <span id="scoreCount">0</span></div>
            <button class="restart-btn" id="restartBtn">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>
    </div>

    <script>
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM WEBAPP (–ò–°–ü–†–ê–í–õ–ï–ù–û)
        const tg = window.Telegram.WebApp;
        
        // 1. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: ready() –∏ expand() –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        tg.ready();
        tg.expand(); // –ë–ï–ó –≠–¢–û–ì–û –ù–ê IPHONE –ù–ï –†–ê–ë–û–¢–ê–ï–¢ [citation:4]
        
        // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ Telegram
        if (tg.version < '7.9') {
            alert('–û–±–Ω–æ–≤–∏—Ç–µ Telegram –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ (–Ω—É–∂–Ω–∞ 7.9+)');
        }
        
        // 3. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ VPN (–¥–ª—è –†–§/–°–ù–ì)
        const vpnWarning = document.getElementById('vpnWarning');
        
        // ----- –í–ï–°–¨ –í–ê–® –ò–ì–†–û–í–û–ô –ö–û–î –ù–ò–ñ–ï (–°–û–ö–†–ê–©–ï–ù –î–õ–Ø –ß–ò–¢–ê–ï–ú–û–°–¢–ò) -----
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const coinSpan = document.getElementById('coinCount');
        const scoreSpan = document.getElementById('scoreCount');
        const restartBtn = document.getElementById('restartBtn');
        
        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥—Ä—ã
        const GROUND_Y = 500;
        const PLAYER_SIZE = 40;
        const OBSTACLE_SIZE = 30;
        const COIN_SIZE = 20;
        
        // –ò–≥—Ä–æ–∫
        let player = {
            x: 50, y: GROUND_Y - PLAYER_SIZE,
            width: PLAYER_SIZE, height: PLAYER_SIZE,
            velY: 0, gravity: 0.5, jumpPower: -12,
            isJumping: false, color: '#3498db'
        };
        
        let obstacles = [], coins = [], gameSpeed = 5, score = 0, coinsCollected = 0, frameCount = 0, gameOver = false, gameStarted = false;
        
        function restartGame() {
            player.y = GROUND_Y - PLAYER_SIZE; player.velY = 0; player.isJumping = false;
            obstacles = []; coins = []; gameSpeed = 5; score = 0; coinsCollected = 0; frameCount = 0; gameOver = false; gameStarted = true;
            updateDisplay();
        }
        
        function updateDisplay() { coinSpan.textContent = coinsCollected; scoreSpan.textContent = score; }
        
        function jump() {
            if (!gameStarted) { gameStarted = true; gameOver = false; restartGame(); return; }
            if (gameOver) { restartGame(); return; }
            if (!player.isJumping) { player.velY = player.jumpPower; player.isJumping = true; }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); jump(); });
        canvas.addEventListener('mousedown', (e) => { e.preventDefault(); jump(); });
        restartBtn.addEventListener('click', (e) => { e.stopPropagation(); restartGame(); });
        
        // ----- –õ–û–ì–ò–ö–ê –ò–ì–†–´ (–ü–û–õ–ù–û–°–¢–¨–Æ –í–ê–®–ê, –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô) -----
        function spawnObstacle() {
            obstacles.push({ x: canvas.width, y: GROUND_Y - OBSTACLE_SIZE, width: OBSTACLE_SIZE, height: OBSTACLE_SIZE, color: '#e74c3c', passed: false });
        }
        function spawnCoin() {
            coins.push({ x: canvas.width, y: GROUND_Y - COIN_SIZE - 40, width: COIN_SIZE, height: COIN_SIZE, color: '#f1c40f' });
        }
        function checkCollision(r1, r2) {
            return r1.x < r2.x + r2.width && r1.x + r1.width > r2.x && r1.y < r2.y + r2.height && r1.y + r1.height > r2.y;
        }
        
        function update() {
            if (!gameStarted || gameOver) return;
            player.velY += player.gravity; player.y += player.velY;
            if (player.y > GROUND_Y - PLAYER_SIZE) { player.y = GROUND_Y - PLAYER_SIZE; player.velY = 0; player.isJumping = false; }
            frameCount++;
            if (frameCount % Math.floor(40 / (gameSpeed/3)) === 0) spawnObstacle();
            if (frameCount % Math.floor(30 / (gameSpeed/3)) === 0) spawnCoin();
            
            for (let i = obstacles.length-1; i>=0; i--) {
                obstacles[i].x -= gameSpeed;
                if (!obstacles[i].passed && obstacles[i].x + obstacles[i].width < player.x) { obstacles[i].passed = true; score += 20; }
                if (obstacles[i].x + obstacles[i].width < 0) obstacles.splice(i,1);
            }
            for (let i = coins.length-1; i>=0; i--) {
                coins[i].x -= gameSpeed;
                if (coins[i].x + coins[i].width < 0) coins.splice(i,1);
            }
            for (let obs of obstacles) {
                if (checkCollision({x:player.x,y:player.y,width:PLAYER_SIZE,height:PLAYER_SIZE}, {x:obs.x,y:obs.y,width:OBSTACLE_SIZE,height:OBSTACLE_SIZE})) { gameOver = true; break; }
            }
            for (let i = coins.length-1; i>=0; i--) {
                if (checkCollision({x:player.x,y:player.y,width:PLAYER_SIZE,height:PLAYER_SIZE}, {x:coins[i].x,y:coins[i].y,width:COIN_SIZE,height:COIN_SIZE})) {
                    coins.splice(i,1); coinsCollected++; score += 10;
                }
            }
            score += 1; if (score % 500 === 0) gameSpeed += 0.5;
            updateDisplay();
        }
        
        function draw() {
            ctx.fillStyle = '#2c3e50'; ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = '#27ae60'; ctx.fillRect(0,GROUND_Y,canvas.width,20);
            ctx.fillStyle = '#34495e'; ctx.fillRect(0,GROUND_Y-2,canvas.width,2);
            ctx.fillStyle = player.color; ctx.shadowBlur = 10; ctx.fillRect(player.x,player.y,PLAYER_SIZE,PLAYER_SIZE);
            ctx.fillStyle = 'white'; ctx.fillRect(player.x+25,player.y+10,8,8); ctx.fillStyle = 'black'; ctx.fillRect(player.x+28,player.y+12,4,4); ctx.shadowBlur = 0;
            for (let obs of obstacles) {
                ctx.fillStyle = obs.color; ctx.fillRect(obs.x,obs.y,OBSTACLE_SIZE,OBSTACLE_SIZE);
                ctx.fillStyle = 'white'; ctx.fillRect(obs.x+5,obs.y+8,6,6); ctx.fillRect(obs.x+18,obs.y+8,6,6);
                ctx.fillStyle = 'black'; ctx.fillRect(obs.x+7,obs.y+10,3,3); ctx.fillRect(obs.x+20,obs.y+10,3,3);
            }
            for (let coin of coins) {
                ctx.fillStyle = coin.color; ctx.shadowBlur = 15; ctx.shadowColor = '#f1c40f';
                ctx.beginPath(); ctx.arc(coin.x+COIN_SIZE/2, coin.y+COIN_SIZE/2, COIN_SIZE/2, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = 'white'; ctx.beginPath(); ctx.arc(coin.x+COIN_SIZE/2+3, coin.y+COIN_SIZE/2-3, 3, 0, Math.PI*2); ctx.fill();
                ctx.shadowBlur = 0;
            }
            if (!gameStarted) {
                ctx.fillStyle = 'rgba(0,0,0,0.7)'; ctx.fillRect(0,0,canvas.width,canvas.height);
                ctx.fillStyle = '#f1c40f'; ctx.font = 'bold 32px Arial'; ctx.textAlign = 'center'; ctx.fillText('JUMP RUNNER', canvas.width/2, canvas.height/2-50);
                ctx.fillStyle = 'white'; ctx.font = '20px Arial'; ctx.fillText('üëÜ –ù–∞–∂–º–∏ –Ω–∞ —ç–∫—Ä–∞–Ω', canvas.width/2, canvas.height/2+30);
            }
            if (gameOver) {
                ctx.fillStyle = 'rgba(0,0,0,0.8)'; ctx.fillRect(0,0,canvas.width,canvas.height);
                ctx.fillStyle = '#e74c3c'; ctx.font = 'bold 36px Arial'; ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2-60);
                ctx.fillStyle = 'white'; ctx.font = '24px Arial'; ctx.fillText(`–°—á–µ—Ç: ${score}`, canvas.width/2, canvas.height/2+20);
                ctx.fillText(`–ú–æ–Ω–µ—Ç—ã: ${coinsCollected}`, canvas.width/2, canvas.height/2+70);
            }
        }
        function gameLoop() { update(); draw(); requestAnimationFrame(gameLoop); }
        gameLoop();
    </script>
</body>
</html>
